# Configuration

## Agent Communication

The sensor tries to communicate with the Instana agent via IP 127.0.0.1 and as a fallback via the host's default gateway for containerized environments. Should the agent not be available under either of these IPs, e.g. due to iptables or other networking tricks, you can use environment variables to configure where the Instana host agent lives.

To use these, these environment variables should be set in the environment of the running Python process.

```shell
export INSTANA_AGENT_HOST = '127.0.0.1'
export INSTANA_AGENT_PORT = '42699'
```

## Debugging & More Verbosity

Setting `INSTANA_DEV` to a non nil value will enable extra logging output generally useful
for development.

```Python
export INSTANA_DEV="true"
```

## Disabling Automatic instrumentation

You can disable automatic instrumentation (tracing) by setting the environment variable `INSTANA_DISABLE_AUTO_INSTR`.  This will suppress the loading of instrumentation built-into the sensor.

## OpenShift

In certain scenarios, the Python sensor can't automatically locate the Instana host agent.  To resolve this, add the following to your Python app deployment descriptor:

```
- name: INSTANA_AGENT_HOST
valueFrom:
  fieldRef:
    fieldPath: status.hostIP
```

This will set the environment variable INSTANA_AGENT_HOST with the IP of the host so the Python sensor can properly locate the Host agent.

## Custom Service Names

Instana will automatically process and discover services from your application.  This process can be further configured by using the [Service Mapper](https://docs.instana.io/products/application_service_management/#service-configuration) in the dashboard.

From the Service Mapper documentation:
> Services are discovered by analyzing traces and grouping them by function. As soon as a service is discovered, Instana will automatically begin monitoring it to learn its health, and to inform you if something needs your attention. To help Instana better match your architecture, you can customize the service detection in a number of ways...

[Source](https://docs.instana.io/products/application_service_management/#service-configuration)

If you still wish to have even greater control from the code level, this section describes how you can configure service names for your application and/or generated traces.

### Application Name as a Service

If you'd like to assign a single service name for the entire application you can do so by setting an environment variable or via code:

```
export INSTANA_SERVICE_NAME=myservice
```

or alternatively, setting `instana.service_name`

```Python
instana.service_name = "myservice"
```

This will cause your entire application to appear as a single service in the Instana Dashboard.

### Setting Service name via code

_Note: The Instana Python Sensor includes instrumentation that is fully automatic.  Custom instrumentation is an optional step for users wishing greater visibility in specific areas of their code._

For those using OpenTracing or using the Instana SDK to custom instrument code, you can set service a service name in one of two ways:

1. On the `Tracer`: affects every trace generated by that `Tracer`
2. On the `Span`: affects only that individual span

### Setting Service Name Per Tracer

The Instana Tracer is an OpenTracing compliant tracer that allows you to custom instrument code.  When instantiating a custom InstanaTracer, you can set a service name that will affect every trace generated by that Tracer.

_Note: service naming at the trace level is only valid on entry spans_

See the following for an example:

```Python
from instana.tracer import InstanaTracer
from instana.options import Options

opts = Options(service: "myservice")
myTracer = InstanaTracer(opts)

entry_span = myTracer.start_span('universe')
entry_span.set_tag('http.method', 'GET')
entry_span.set_tag('http.url', '/users')
entry_span.set_tag('span.kind', 'entry')
entry_span.finish()
```

The above code will generate a span named "universe" with a custom service name of "myservice".

### Setting Service Name per Span

For even greater control, you can specify the service name with a tag on the span.

_Note #1: OpenTracing does not yet support custom service naming so the following is Instana specific._
_Note #2: Service naming at the trace level is only valid on entry spans_

```Python
from instana.tracer import InstanaTracer

myTracer = InstanaTracer()

entry_span = myTracer.start_span('universe')
entry_span.set_tag('instana.service', "myservice")
entry_span.finish()
```

## Service Naming Priority

It's possible that in the process of above, there may be a service name specified in multiple places.  In such cases, the following details which case takes priority (highest to lowest):

1. Span service name
2. Tracer service name
3. Application service name
4. Instana Dashboard Service Mapper
4. Default Instana service extraction
